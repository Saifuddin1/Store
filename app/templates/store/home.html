{% extends "layout/customer_base.html" %}

{% block title %}Home | My Store{% endblock %}

{% block content %}

<!-- ================= HERO SECTION ================= -->
<div class="bg-dark text-white p-5 rounded mb-5">
  <div class="row align-items-center">
    <div class="col-md-7">
      <h1 class="display-5 fw-bold">Welcome to My Store</h1>
      <p class="lead mt-3">
        Shop premium sarees, t-shirts and lifestyle products at best prices.
      </p>
      <a href="{{ url_for('main.products') }}"
         class="btn btn-primary btn-lg mt-3">
        üõç Shop Now
      </a>
    </div>
  </div>
</div>

<!-- ================= CATEGORIES ================= -->
<h3 class="mb-4">Shop by Category</h3>

{% if categories %}
<div class="row mb-5">
  {% for c in categories %}
  <div class="col-lg-3 col-md-4 col-sm-6 mb-4">

    <a href="{{ url_for('main.category_products', slug=c.slug) }}"
       class="text-decoration-none text-dark">

      <div class="card h-100 shadow-sm text-center category-card">
        <div class="card-body d-flex align-items-center justify-content-center">
          <h5 class="mb-0">{{ c.name }}</h5>
        </div>
      </div>

    </a>

  </div>
  {% endfor %}
</div>
{% else %}
<p class="text-muted">No categories available.</p>
{% endif %}

<!-- ================= LATEST PRODUCTS ================= -->
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="mb-0">Latest Products</h3>

  <a href="{{ url_for('main.products') }}"
     class="btn btn-outline-secondary btn-sm">
    View All Products
  </a>
</div>

{% if products %}
<div class="row">

{% for p in products %}
<div class="col-lg-3 col-md-4 col-sm-6 mb-4">

  <div class="card h-100 shadow-sm product-card">

    <!-- IMAGE + BADGES -->
    <div class="position-relative">

      {% if p.primary_image %}
        <img src="{{ url_for('static', filename=p.primary_image) }}"
             class="card-img-top"
             style="height:220px; object-fit:cover;">
      {% else %}
        <div class="bg-light d-flex align-items-center justify-content-center"
             style="height:220px;">
          <span class="text-muted">No Image</span>
        </div>
      {% endif %}

      <!-- üì¶ STOCK STATUS BADGE -->
      {% if p.stock_quantity <= 0 %}
        <span class="badge bg-danger position-absolute top-50 start-50 translate-middle px-3 py-2">
          ‚ùå Out of Stock
        </span>

      {% elif p.stock_quantity <= 2 %}
        <span class="badge bg-danger position-absolute bottom-0 end-0 m-2 px-2 py-1">
          üî• Only {{ p.stock_quantity }} left
        </span>

      {% elif p.stock_quantity <= 5 %}
        <span class="badge bg-warning text-dark position-absolute bottom-0 end-0 m-2 px-2 py-1">
          ‚è≥ Limited Stock
        </span>
      {% endif %}


      <!-- ‚ù§Ô∏è WISHLIST -->
      {% if current_user.is_authenticated %}
      <form method="POST"
            action="{{ url_for('main.toggle_wishlist', product_id=p.id) }}"
            class="position-absolute top-0 end-0 m-2">
        <button type="submit"
                class="btn btn-sm btn-light rounded-circle shadow">
          ‚ù§Ô∏è
        </button>
      </form>
      {% endif %}

      <!-- üî• TOP RATED -->
      {% if rating_map.get(p.id)
            and rating_map[p.id].avg >= 4.5
            and rating_map[p.id].count >= 5 %}
        <span class="badge bg-warning text-dark position-absolute top-0 start-0 m-2">
          üî• Top Rated
        </span>
      {% endif %}

      <!-- üí∏ DISCOUNT -->
      {% if p.final_price < p.price %}
        <span class="badge bg-success position-absolute bottom-0 start-0 m-2 px-2 py-1">
          {% if p.discount_type == "percent" %}
            {{ p.discount_value|int }}% OFF
          {% else %}
            ‚Çπ{{ p.price - p.final_price }} OFF
          {% endif %}
        </span>
      {% endif %}

    </div>

    <!-- PRODUCT DETAILS -->
    <div class="card-body d-flex flex-column">

      <h6 class="card-title mb-1">{{ p.name }}</h6>

      {% if rating_map.get(p.id) %}
        {% set r = rating_map[p.id] %}
        <div class="small mb-1">
          <span class="text-warning">
            {% for i in range(r.avg|int) %}‚≠ê{% endfor %}
            {% for i in range(5 - (r.avg|int)) %}‚òÜ{% endfor %}
          </span>
          <span class="text-muted">
            {{ r.avg }} ({{ r.count }})
          </span>
        </div>
      {% endif %}

      <p class="mb-2">
        {% if p.final_price < p.price %}
          <span class="fw-bold text-success fs-6">
            ‚Çπ{{ p.final_price }}
          </span>
          <del class="text-muted ms-2">‚Çπ{{ p.price }}</del>
        {% else %}
          <span class="fw-bold fs-6">‚Çπ{{ p.price }}</span>
        {% endif %}
      </p>

      <a href="{{ url_for('main.product_detail', slug=p.slug) }}"
         class="btn btn-outline-primary mt-auto w-100">
        View Product
      </a>

    </div>

  </div>

</div>
{% endfor %}

</div>
{% else %}
<div class="alert alert-info">
  No products available.
</div>
{% endif %}

<!-- ================= STYLES ================= -->
<style>
.category-card:hover {
  background-color: #f8f9fa;
  transform: translateY(-4px);
  transition: 0.2s ease;
}

.product-card:hover {
  transform: translateY(-6px);
  transition: 0.2s ease;
}

.badge {
  font-size: 0.75rem;
}
</style>

{% endblock %}
