{% extends "layout/customer_base.html" %}

{% block title %}Your Cart | My Store{% endblock %}

{% block content %}

<h2 class="mb-4">Your Cart</h2>

<a href="/" class="btn btn-link mb-3">
  ‚Üê Continue Shopping
</a>

{% if items %}
<div class="card shadow-sm mb-4">
  <div class="card-body p-0">

    <table class="table align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>Product</th>
          <th>Price</th>
          <th style="width:120px;">Quantity</th>
          <th>Subtotal</th>
          <th></th>
        </tr>
      </thead>

      <tbody>
        {% for item in items %}
        <tr>

          <!-- Product -->
          <td>
            <div class="d-flex align-items-center">
              {% if item.image %}
                <img src="{{ url_for('static', filename=item.image) }}"
                     class="me-3 rounded"
                     style="width:70px; height:70px; object-fit:cover;">
              {% endif %}
              <strong>{{ item.name }}</strong>
            </div>
          </td>

          <!-- Price -->
          <td>{{ item.final_price }}</td>

          <!-- Quantity -->
          <td>
            <form method="POST"
                  action="{{ url_for('main.cart_update') }}"
                  class="d-flex">
              <input type="hidden"
                     name="product_id"
                     value="{{ item.product_id }}">

              <input type="number"
                     name="qty"
                     value="{{ item.qty }}"
                     min="1"
                     class="form-control form-control-sm me-2">

              <button type="submit"
                      class="btn btn-sm btn-outline-secondary">
                Update
              </button>
            </form>
          </td>

          <!-- Subtotal -->
          <td>
            <strong>
              {{ item.final_price * item.qty }}
            </strong>
          </td>

          <!-- Remove -->
          <td>
            <form method="POST"
                  action="{{ url_for('main.cart_remove', product_id=item.product_id) }}">
              <button type="submit"
                      class="btn btn-sm btn-outline-danger">
                Remove
              </button>
            </form>
          </td>

        </tr>
        {% endfor %}
      </tbody>
    </table>

  </div>
</div>

<!-- Cart Summary -->
<div class="row">
  <div class="col-md-6"></div>

  <div class="col-md-6">
    <div class="card shadow-sm">
      <div class="card-body">

        <h5 class="mb-3">Cart Summary</h5>

        <p class="mb-1">
          <strong>Total Items:</strong> {{ totals.total_qty }}
        </p>
        <p class="mb-3">
          <strong>Total Price:</strong> {{ totals.total_price }}
        </p>

        <div class="d-grid">
          <a href="{{ url_for('main.checkout') }}"
             class="btn btn-primary btn-lg">
            Proceed to Checkout
          </a>
        </div>

      </div>
    </div>
  </div>
</div>

{% else %}
<div class="alert alert-info">
  Your cart is empty.
</div>
{% endif %}

{% endblock %}
