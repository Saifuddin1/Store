{% extends "layout/customer_base.html" %}

{% block title %}Your Cart | {{ site_settings.site_name }}{% endblock %}

{% block content %}

<div class="container">

  <!-- ================= HEADER ================= -->
  <div class="mb-4">
    <h2 class="fw-bold mb-1">üõí Shopping Cart</h2>
    <p class="text-muted mb-0">Review your items before checkout</p>
  </div>

  <a href="{{ url_for('main.home') }}" class="btn btn-link p-0 mb-4">
    ‚Üê Continue Shopping
  </a>

  {% if items %}
  <div class="row g-4">

    <!-- ================= ITEMS ================= -->
    <div class="col-lg-8">

      {% for item in items %}
      <div class="card shadow-sm mb-3 border-0">
        <div class="card-body">

          <div class="d-flex gap-3 align-items-start">

            <!-- IMAGE -->
            {% if item.image %}
            <img src="{{ url_for('static', filename=item.image) }}"
                 class="rounded"
                 style="width:90px;height:90px;object-fit:cover;">
            {% endif %}

            <!-- DETAILS -->
            <div class="flex-grow-1">

              <div class="fw-semibold">{{ item.name }}</div>

              <!-- PRICE -->
              <div class="mt-1">
                {% if item.price != item.final_price %}
                  <span class="text-muted text-decoration-line-through me-2">
                    ‚Çπ{{ item.price }}
                  </span>
                {% endif %}
                <span class="fw-bold text-dark">
                  ‚Çπ{{ item.final_price }}
                </span>
              </div>

              <!-- QTY + REMOVE -->
              <div class="d-flex align-items-center gap-3 mt-3">

                <!-- QUANTITY -->
                <form method="POST"
                      action="{{ url_for('main.cart_update') }}">
                  <input type="hidden" name="product_id" value="{{ item.product_id }}">

                  <select name="qty"
                          class="form-select form-select-sm"
                          onchange="this.form.submit()"
                          style="width:90px;">
                    {% for i in range(1, item.stock_quantity + 1) %}
                      <option value="{{ i }}"
                              {% if i == item.qty %}selected{% endif %}>
                        {{ i }}
                      </option>
                    {% endfor %}
                  </select>
                </form>

                <!-- REMOVE -->
                <form method="POST"
                      action="{{ url_for('main.cart_remove', product_id=item.product_id) }}">
                  <button class="btn btn-sm btn-outline-danger">
                    Remove
                  </button>
                </form>

              </div>

            </div>

            <!-- SUBTOTAL -->
            <div class="text-end fw-semibold">
              ‚Çπ{{ item.final_price * item.qty }}
            </div>

          </div>

        </div>
      </div>
      {% endfor %}

    </div>

    <!-- ================= SUMMARY ================= -->
    <div class="col-lg-4">

      <div class="card shadow-sm border border-dark">
        <div class="card-body">

          <h5 class="fw-bold mb-3">Price Details</h5>

          <div class="d-flex justify-content-between mb-2">
            <span>Items ({{ totals.total_qty }})</span>
            <span>‚Çπ{{ totals.subtotal }}</span>
          </div>

          <div class="d-flex justify-content-between mb-2">
            <span>Delivery Fee</span>
            {% if totals.delivery_fee == 0 %}
              <span class="text-success">FREE</span>
            {% else %}
              <span>‚Çπ{{ totals.delivery_fee }}</span>
            {% endif %}
          </div>

          <hr>

          <div class="d-flex justify-content-between fw-bold fs-5 mb-3">
            <span>Total Amount</span>
            <span>‚Çπ{{ totals.grand_total }}</span>
          </div>

          {% if totals.delivery_fee > 0 %}
          <div class="alert alert-info small">
            Add items worth ‚Çπ{{ 500 - totals.subtotal }} more for FREE delivery üöö
          </div>
          {% endif %}

          <div class="d-grid">
            <a href="{{ url_for('main.checkout') }}"
               class="btn btn-primary btn-lg">
              Proceed to Checkout
            </a>
          </div>

        </div>
      </div>

    </div>

  </div>

  {% else %}
  <div class="alert alert-info text-center py-4">
    <h5>Your cart is empty</h5>
    <a href="{{ url_for('main.home') }}" class="btn btn-outline-primary">
      Start Shopping
    </a>
  </div>
  {% endif %}

</div>

{% endblock %}
