{% extends "layout/base.html" %}
{% block title %}Forgot Password{% endblock %}

{% block content %}
<div class="container mt-5" style="max-width:420px">

  <h4 class="mb-3 text-center">Reset Password</h4>

  {% if not user %}
  <!-- EMAIL VERIFY -->
  <form method="POST">
    <input type="email"
           name="email"
           class="form-control mb-3"
           placeholder="Enter your registered email"
           required>

    <button class="btn btn-outline-dark w-100">
      Verify Email
    </button>
  </form>
  {% endif %}

  {% if user %}
  <!-- PASSWORD RESET -->
  <form method="POST">

    <!-- EMAIL (READ ONLY) -->
    <input type="email"
           class="form-control mb-3"
           value="{{ user.email }}"
           readonly>

    <input type="hidden" name="email" value="{{ user.email }}">

    <!-- PASSWORD -->
    <input type="password"
           id="password"
           name="password"
           class="form-control mb-2"
           placeholder="New password"
           required>

    <!-- CONFIRM PASSWORD -->
    <input type="password"
           id="confirm_password"
           class="form-control mb-2"
           placeholder="Confirm password"
           required>

    <!-- LIVE ERROR -->
    <div id="passwordError"
         class="small text-danger mb-2 d-none"></div>

    <button id="submitBtn"
            class="btn btn-dark w-100"
            disabled>
      Reset Password
    </button>

  </form>
  {% endif %}

  <div class="text-center mt-3">
    <a href="{{ url_for('auth.login') }}" class="btn btn-outline-success">
      Back to Login
    </a>
  </div>

</div>

<script>
const password = document.getElementById("password");
const confirmPassword = document.getElementById("confirm_password");
const errorBox = document.getElementById("passwordError");
const submitBtn = document.getElementById("submitBtn");

function validatePasswords() {
  const pwd = password.value;
  const cpwd = confirmPassword.value;

  errorBox.classList.remove("d-none");
  submitBtn.disabled = true;

  if (pwd.length === 0 && cpwd.length === 0) {
    errorBox.classList.add("d-none");
    return;
  }

  if (pwd.length < 6) {
    errorBox.textContent = "Password must be at least 6 characters";
    return;
  }

  if (cpwd.length > 0 && pwd !== cpwd) {
    errorBox.textContent = "Passwords do not match";
    return;
  }

  // âœ… ALL GOOD
  errorBox.classList.add("d-none");
  submitBtn.disabled = false;
}

password?.addEventListener("input", validatePasswords);
confirmPassword?.addEventListener("input", validatePasswords);
</script>

{% endblock %}
